{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/0127/","result":{"data":{"site":{"siteMetadata":{"title":"なばろぐ","description":"プログラミング、ピアノ作曲・演奏、雑記など"}},"markdownRemark":{"html":"<div class=\"alert info\">\nはてなブログからの移行記事\n</div>\n<h1>はじめに</h1>\n<p>React の開発環境構築として、実行環境を node の Docker コンテナを使用することにしたので、構築手順をまとめます。<br>\n今回覚えながら docker-compose を使用したので、理解の間違いなどがあれば指摘いただけると嬉しいです。</p>\n<h2>環境</h2>\n<ul>\n<li>Windows 10 Pro (2004)</li>\n<li>Docker for Windows 2.2.0.0</li>\n</ul>\n<h2>完成イメージ</h2>\n<figure class=\"figure-image figure-image-fotolife\" title=\"完成形イメージ\">[f:id:naba0123:20200126224944j:w500]<figcaption>ホストOSとコンテナでは、ソースコードと、3000番ポートを共有している</figcaption></figure>\n<h1>docker-compose.yml の作成</h1>\n<p>作業ディレクトリを作成したら、まず ** docker-compose.yml ** を作成します。<br>\n** docker-compose.yml ** を使用することで、通常 <code class=\"language-text\">docker</code> コマンドに色々引数やらつけなくちゃいけないものを、一元管理することができます。<br>\nまた、実行する際も <code class=\"language-text\">docker-compose</code> コマンドを使用します。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">node</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">:</span>12.14.1\n        <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./<span class=\"token punctuation\">:</span>/usr/src/app\n        <span class=\"token key atrule\">working_dir</span><span class=\"token punctuation\">:</span> /usr/src/app\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span>\n        <span class=\"token key atrule\">tty</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<ul>\n<li>** version ** : docker-compose で使用するバージョンになります。<br>\nドキュメント：<a href=\"https://docs.docker.com/compose/compose-file/\">https://docs.docker.com/compose/compose-file/</a></li>\n<li>\n<p>** services ** : ** version ** と同じインデントに記載します。<br>\n※参考記事ではインデントを深くしており、そのまま真似てしまうとエラーになってしまいました。（気付くまで時間がかかった）</p>\n<ul>\n<li>** node ** : ** services ** で定義するサービス名です。何でも良いですが、<code class=\"language-text\">docker-compose up サービス名</code> のように使用するので、分かりやすい名前にしておきます。<br>\n今回は、使用するコンテナのイメージが node なので、定義する名前も node にしておきます。</li>\n<li>** image ** : ** node ** サービスで使用するイメージ元です。<br>\n今回のように直接 image を指定することもあれば、 ** build ** セクションを記載して、<code class=\"language-text\">docker-compose build</code> でイメージをビルドしてから起動する方法もあります。</li>\n<li>** volumes ** : ホストOSと共有するディレクトリになります。<br>\nコロンより前がホスト側のパス（ <code class=\"language-text\">docker-compose</code> を実行するディレクトリからの相対パスとして、自身のディレクトリを指定）、後がコンテナ内のパスです。</li>\n<li>** working_dir ** : コンテナ内でコマンドを実行する際の、起点となるディレクトリです。<br>\n今回は、後ほど <code class=\"language-text\">docker-compose exec node /bin/bash</code> でコマンド内で作業をするので、そのログイン時のはじめのディレクトリを指定しておきます。</li>\n<li>** ports ** : ホストとコンテナでポートフォワードを行うポートを指定します。<br>\nコロンより前がホスト側、後がコンテナ側で、今回はコンテナ内で3000ポートで動いているアプリケーションに、ホストの3000を割り当てています。<br>\nこれにより、Reactアプリケーションの起動後に <a href=\"http://localhost:3000/\">http://localhost:3000/</a> でアクセスができるわけです。</li>\n<li>** tty:true ** : これを書いておくことで、<code class=\"language-text\">docker-compose up</code> 後に実行するコマンドがなく即コンテナが終了することなく、待機状態となります。<br>\nドキュメント：<a href=\"https://docs.docker.com/compose/compose-file/#domainname-hostname-ipc-mac_address-privileged-read_only-shm_size-stdin_open-tty-user-working_dir\">https://docs.docker.com/compose/compose-file/#domainname-hostname-ipc-mac<em>address-privileged-read</em>only-shm<em>size-stdin</em>open-tty-user-working_dir</a></li>\n</ul>\n</li>\n</ul>\n<h1>コンテナ起動</h1>\n<p>docker-compose.yml を作成したら、コンテナを起動します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker-compose up\nCreating network &quot;app_default&quot; with the default driver\nPulling node (node:12.14.1)...\n12.14.1: Pulling from library/node\n146bd6a88618: Pull complete\n9935d0c62ace: Pull complete\ndb0efb86e806: Pull complete\ne705a4c4fd31: Pull complete\nc877b722db6f: Pull complete\n645c20ec8214: Pull complete\n72851fd0a9e4: Pull complete\nc97d6cf2691b: Pull complete\n7df0baa2324d: Pull complete\nDigest: sha256:0a68eb463c4ab4db0833c786cc484ea2edfd50e73e606380e30b806aeb9eee5a\nStatus: Downloaded newer image for node:12.14.1\nCreating app_node_1 ... done\nAttaching to app_node_1\nnode_1  | Welcome to Node.js v12.14.1.\nnode_1  | Type &quot;.help&quot; for more information.</code></pre></div>\n<p>初回は、** node:12.14.1 ** イメージをダウンロードするので pull したりするログが流れますが、最後に node が起動してるっぽいログが出てきたらOKです。  </p>\n<p>今回実行した <code class=\"language-text\">docker-compose up</code> は、docker-compose.yml に記載されているサービスを全部起動するという処理になっています。<br>\n今回 services には node しか書いていませんので <code class=\"language-text\">docker-compose up node</code> と同義となります。</p>\n<p>ただし、現在フォアグラウンドで実行中、かつ何も動作をしない状態なので、これ以上動けず、ログを吐き出し続けます。<br>\n一度「Ctrl+C」でコンテナを終了（フォアグラウンドで実行しているものを停止させるので、この場合はコンテナも停止します）させるか、別のターミナル（ PowerShell など）を立ち上げて、次の作業を行ってください。</p>\n<p>バックグラウンドでの実行（<code class=\"language-text\">docker-compose up -d</code>）後、またはフォアグラウンドで実行中に別のターミナル（ PowerShell ）でコンテナが起動していることを確認します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$  docker-compose ps\n   Name               Command            State           Ports\n-----------------------------------------------------------------------\napp_node_1   docker-entrypoint.sh node   Up      0.0.0.0:3000-&gt;3000/tcp</code></pre></div>\n<h1>コンテナ内で React アプリを作成する</h1>\n<p>実行中のコンテナに入るには、<code class=\"language-text\">docker-compose exec</code> を使用します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ docker-compose exec node /bin/bash\nroot@cf0b2b9f6a64:/usr/src/app#</code></pre></div>\n<p>無事にコンテナ内に入り、はじめの作業ディレクトリが、先程 docker-compose.yml で指定した ** /usr/src/app ** になっていることがわかります。</p>\n<p>次に、react アプリを作成します。<br>\nnode のイメージを使用しているので、node はもちろん入っています。<br>\n** react-sample ** という名前で新規の React アプリを作成します。<br>\ncreate-react-app は結構時間がかかります（私の環境では20分ぐらい）。のんびり待ちましょう。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">root@cf0b2b9f6a64:/usr/src/app# node --version\nv12.14.1\nroot@cf0b2b9f6a64:/usr/src/app# npm --version\n6.13.4\nroot@cf0b2b9f6a64:/usr/src/app# yarn --version\n1.21.1\n\nroot@cf0b2b9f6a64:/usr/src/app# npm install -g create-react-app\n/usr/local/bin/create-react-app -&gt; /usr/local/lib/node_modules/create-react-app/index.js\n+ create-react-app@3.3.0\nadded 91 packages from 45 contributors in 6.867s\n\nroot@cf0b2b9f6a64:/usr/src/app# create-react-app react-sample\n～長い～\n※最後に Success とか出てくる</code></pre></div>\n<h1>React アプリの実行</h1>\n<p>React アプリの実行は、<code class=\"language-text\">yarn</code> コマンドを使用します。<br>\n<code class=\"language-text\">yarn</code> は <code class=\"language-text\">npm</code> については、検索するといろんな記事が出てきます。\n<a href=\"https://www.d-wood.com/blog/2017/05/25_8979.html\">https://www.d-wood.com/blog/2017/05/25_8979.html</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ cd react-sample\n$ pwd\n/usr/src/app/react-sample\n\n$ yarn start\n※以下は出力（出力に$とか入ってるので念の為）\nyarn run v1.21.1\n$ react-scripts start\nCompiled successfully!\n\nYou can now view react-sample in the browser.\n\n  Local:            http://localhost:3000/\n  On Your Network:  http://172.22.0.2:3000/\n\nNote that the development build is not optimized.\nTo create a production build, use yarn build.</code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB80lEQVQ4y5WSS08TURiGZ+Ulxn8gGKGX6XRK7xemrUGxqWxITDQI5dIygMGdMUatIfEH6MLEP6Ds3Lgw8RfgwkRjsFRjY4wiRgU0kuCNKA9nDqWWOigsnnzvfHnznu+bc5Rzkw+586DC3Udz3C8tcG96nqnKJ3puvUQ5X2JvcYZdl0r2XJ5ht2BPscz+iWfsu1JGefPuA/z8yq/vy6yKyu8VVpY/8/r9Ik9ml6gs/ODFvD3PP35jevYLj18tMlWe4+nbJZSegTP0DY5wut+U9A6YnOzNk+svMFwYwTTHNjNcRepRCsKTz5sMDa77lSZngOYWjeZW7zotXg626lI3CX3gkPZPLE89iuo30HxRtLaYoL5uaIE/jscXETXxp1cjusmvuHwJVG8Ytx5BreIW37JqITwiLJ47S3LsIv7ObpxOHVUMsOFpxDawFuwJEu7O0Xn1Jtlrt0mNF9EiaXmQXZhtYP3JVmCw6xRHJ26QvT6JMXoBT9CQ/kavbWDNIKpLTOEUgS6hwyeGiPaNo6ezOBy67Lm3CLWd0NJtIUPiDyfxBeL4xE+3tNULRJLyEv47YX1gzDhCrL2DROoYcUF7x3ES6YzsG4cz6OKQHa1srSvRwmhGBm+6CzWUwqkGcKjBna+sboNtrfzXW6xegLvhIrZ6h2sRuwGdlXyMdAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20200127000835\"\n        title=\"20200127000835\"\n        src=\"/static/053678aaf7a697fc9664d8f200a81455/e17e5/20200127000835.png\"\n        srcset=\"/static/053678aaf7a697fc9664d8f200a81455/7e516/20200127000835.png 100w,\n/static/053678aaf7a697fc9664d8f200a81455/772e8/20200127000835.png 200w,\n/static/053678aaf7a697fc9664d8f200a81455/e17e5/20200127000835.png 400w,\n/static/053678aaf7a697fc9664d8f200a81455/0a47e/20200127000835.png 600w,\n/static/053678aaf7a697fc9664d8f200a81455/e51a6/20200127000835.png 783w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">20200127000835</figcaption>\n  </figure></p>\n<p>これで React アプリが起動しました。<br>\nホストPCとは3000ポートがすでにフォワーディングされていますので、ブラウザで ** <a href=\"http://localhost:3000/\">http://localhost:3000/</a> ** にアクセスすると、 React の Welcome ページが出てくるはずです。お疲れさまでした！</p>\n<p><code class=\"language-text\">yarn start</code> についてですが、今回のようにいちいちコンテナに入って打つよりも、参考記事にあった<br>\n「docker-compose.yml 内に起動時のコマンドとして <code class=\"language-text\">cd react-sample &amp;&amp; yarn start</code> を指定する」<br>\nという方法もあるようですが、私の環境では1回目は成功するのですが、一度落として再度 ** docker-compose up **しようとすると、  </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Error: ENOENT: no such file or directory, uv_cwd</code></pre></div>\n<p>のようなエラーが出てきてしまい実行できない、という状況になってしまいました。<br>\n（調べてみるとどうやら node.js のエラーらしいです）<br>\nちなみにこれは Docker for Windows を再起動することで一応直るのですが、毎回立ち上げ直すのが手間で、「コンテナ内から実行したらエラーが起きない」ということに気づいたので、今回の形となりました。</p>\n<h1>環境構築直後のディレクトリ構造</h1>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB50lEQVQ4y5VTa2/iMBDMv7i2gpLE7zgPkxcQEdrqKvH/f9HcOJQetOpJ92G0thPP7syuEx06KKMhlITSCrkUjBJl5eGrAmXtoa1CmqcwzsASyihowhUOkveeN8+8ly9I5tMBIXic5okklsQpvBGYhxaHQ4/jceS5QZqtiPVNvKwzxixfw1oJITdIjJOYjwPOv2fML3vMpxGh9XCOpNZh8haqyKF1BmNzVpgv8eu6LKiq1EgKb5hhA1vYRc7j0wMysYHzEp7JJmsx8J+wVaiqaEdGufcwJqcNGS1QSDxlTlOL8/kVL6xunnt0XUlyAUvShv7N3qHfaux2JA7yQsKqPgk/1j5WGH0bxgbv70fsdwHDULOa4pOwsxpTYTAEzW8abasWqVeiK+I+ciVl7bBJV6jZUc3LD4+/aG66ZGuCw0jyI5vz9tpiHByq2mK7tUx6g2CXJI4+LpKFzNCzq85prNZP9OneeOeiTPGxF8vZV8QKC08PG46MZEV9H9B2AblIOVv3Hl3kfW/GVyyEcWyEXLPCBtu2ofz1HeGtT/+CvnZZcpClFRj3nL9Qf5P8v0gimRYCTV2hKONTEkuFP8lSOv0R8XsyjR59V9O/ml2OxtN0dqvgyMSu3SKexWfoK32JnISIsvob/wARo36Fa5fd4AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20200127001704\"\n        title=\"20200127001704\"\n        src=\"/static/19b60cd8a899ff9bc7ebd6c7035cbb22/e17e5/20200127001704.png\"\n        srcset=\"/static/19b60cd8a899ff9bc7ebd6c7035cbb22/7e516/20200127001704.png 100w,\n/static/19b60cd8a899ff9bc7ebd6c7035cbb22/772e8/20200127001704.png 200w,\n/static/19b60cd8a899ff9bc7ebd6c7035cbb22/e17e5/20200127001704.png 400w,\n/static/19b60cd8a899ff9bc7ebd6c7035cbb22/0a47e/20200127001704.png 600w,\n/static/19b60cd8a899ff9bc7ebd6c7035cbb22/5a190/20200127001704.png 800w,\n/static/19b60cd8a899ff9bc7ebd6c7035cbb22/e4374/20200127001704.png 927w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">20200127001704</figcaption>\n  </figure></p>\n<h1>参考</h1>\n<p><a href=\"https://blog.web.nifty.com/engineer/2714\">https://blog.web.nifty.com/engineer/2714</a>\n<a href=\"https://qiita.com/yuta-ushijima/items/d3d98177e1b28f736f04\">https://qiita.com/yuta-ushijima/items/d3d98177e1b28f736f04</a>\n<a href=\"https://unskilled.site/%E4%BD%BF%E3%81%84%E6%96%B9%E5%9F%BA%E6%9C%AC%E7%89%88dockercompose%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E3%83%BB%E9%80%A3%E6%90%BA%E3%82%92%E6%A5%BD/\">https://unskilled.site/%E4%BD%BF%E3%81%84%E6%96%B9%E5%9F%BA%E6%9C%AC%E7%89%88dockercompose%E3%81%A7%E3%82%B3%E3%83%B3%E3%83%86%E3%83%8A%E7%AB%8B%E3%81%A1%E4%B8%8A%E3%81%92%E3%83%BB%E9%80%A3%E6%90%BA%E3%82%92%E6%A5%BD/</a></p>","frontmatter":{"title":"Docker + React 開発環境を整える","date":"2020/01/27 00:22","tags":["React"]},"id":"51b213cd-04d8-5487-8ecd-9d4a5518a6c6","excerpt":"はじめに React の開発環境構築として、実行環境を node の Docker コンテナを使用することにしたので、構築手順をまとめます。 今回覚えながら docker-compose を使用したので、理解の間違いなどがあれば指摘いただけると嬉しいです。 環境 Windows…"},"relatedPosts":{"edges":[{"node":{"fields":{"slug":"/2020/0127/"},"frontmatter":{"title":"Docker + React 開発環境を整える","date":"2020/01/27 00:22","tags":["React"]},"id":"51b213cd-04d8-5487-8ecd-9d4a5518a6c6"}}]}},"pageContext":{"slug":"/2020/0127/","tags":["React"]}}}